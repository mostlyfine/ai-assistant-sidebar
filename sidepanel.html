<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gemini Sidebar</title>
  <link rel="stylesheet" href="styles/sidepanel.css">
</head>
<body>
  <!-- APIè¨­å®šç”»é¢ -->
  <div id="setupScreen" class="screen">
    <div class="setup-container">
      <div class="header">
        <h1 data-i18n="appTitle">ğŸ¤– AI Assistant</h1>
        <p data-i18n="setupTitle">AI APIã‚’è¨­å®šã—ã¦ãã ã•ã„</p>
      </div>
      
      <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
      <div class="tab-navigation">
        <button class="tab-button active" data-tab="vertex-ai" data-i18n="tabVertexAI"><img src="icons/vertex.png" alt="Vertex AI" class="tab-icon"><span>Vertex AI</span></button>
        <button class="tab-button" data-tab="openai-compatible" data-i18n="tabOpenAICompatible"><img src="icons/openai.png" alt="OpenAI" class="tab-icon"><span>OpenAI Compatible</span></button>
        <button class="tab-button" data-tab="aws-bedrock" data-i18n="tabAWSBedrock"><img src="icons/bedrock.png" alt="AWS Bedrock" class="tab-icon"><span>AWS Bedrock</span></button>
        <button class="tab-button" data-tab="general" data-i18n="tabGeneral"><img src="icons/setting.png" alt="è¨­å®š" class="tab-icon"><span>å…¨ä½“è¨­å®š</span></button>
      </div>

      <!-- Vertex AIè¨­å®šã‚¿ãƒ– -->
      <div id="vertex-ai-tab" class="tab-content active">
        <h3 data-i18n="vertexAISettings">Vertex AI è¨­å®š</h3>
        
        <!-- èªè¨¼æ–¹å¼é¸æŠ -->
        <div class="input-group">
          <label data-i18n="authMethod">èªè¨¼æ–¹å¼</label>
          <div class="auth-method-selection">
            <label class="radio-option">
              <input type="radio" name="vertexAuthMethod" value="service-account" checked>
              <span class="radio-custom"></span>
              <span data-i18n="serviceAccountJSON">Service Account JSON</span>
            </label>
            <label class="radio-option">
              <input type="radio" name="vertexAuthMethod" value="api-key">
              <span class="radio-custom"></span>
              <span data-i18n="apiKey">API Key</span>
            </label>
          </div>
        </div>

        <!-- Service Accountè¨­å®š -->
        <div id="serviceAccountSection">
          <div class="input-group">
            <label for="serviceAccountFile" data-i18n="serviceAccountFile">Service Account JSON ãƒ•ã‚¡ã‚¤ãƒ«</label>
            <div class="file-input-container">
              <input type="file" id="serviceAccountFile" accept=".json" style="display: none;">
              <button type="button" id="selectFileButton" class="file-select-button">
                <span data-i18n="selectJSONFile">ğŸ“ JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</span>
              </button>
              <span id="selectedFileName" class="file-name"></span>
            </div>
          </div>
          
          <div class="service-account-info" id="serviceAccountInfo" style="display: none;">
            <h4 data-i18n="serviceAccountInfo">Service Account æƒ…å ±</h4>
            <div class="info-item">
              <span class="label" data-i18n="projectId">Project ID:</span>
              <span id="projectId"></span>
            </div>
            <div class="info-item">
              <span class="label" data-i18n="email">Email:</span>
              <span id="serviceAccountEmail"></span>
            </div>
            <div class="info-item">
              <span class="label" data-i18n="keyId">Key ID:</span>
              <span id="serviceAccountKeyId"></span>
            </div>
          </div>
        </div>

        <!-- API Keyè¨­å®š -->
        <div id="apiKeySection" style="display: none;">
          <div class="input-group">
            <label for="vertexProjectId" data-i18n="projectId">Project ID</label>
            <input type="text" id="vertexProjectId" data-i18n-placeholder="placeholderGoogleCloudProjectId">
          </div>
          <div class="input-group">
            <label for="vertexApiKey" data-i18n="apiKey">API Key</label>
            <input type="password" id="vertexApiKey" data-i18n-placeholder="placeholderVertexApiKey">
          </div>
        </div>
        
        <div class="input-group" id="locationGroup" style="display: none;">
          <label for="location" data-i18n="location">Location (ãƒªãƒ¼ã‚¸ãƒ§ãƒ³)</label>
          <select id="location">
            <option value="us-central1">us-central1</option>
            <option value="us-west1">us-west1</option>
            <option value="asia-northeast1">asia-northeast1</option>
            <option value="europe-west1">europe-west1</option>
          </select>
        </div>

        <div class="input-group" id="vertexModelGroup" style="display: none;">
          <label for="vertexModel" data-i18n="model">ãƒ¢ãƒ‡ãƒ«</label>
          <select id="vertexModel">
            <option value="gemini-2.5-pro">gemini-2.5-pro</option>
            <option value="gemini-2.5-flash">gemini-2.5-flash</option>
            <option value="gemini-2.0-flash">gemini-2.0-flash</option>
            <option value="gemini-2.0-flash-exp">gemini-2.0-flash-exp (US only)</option>
            <option value="gemini-1.5-flash-002">gemini-1.5-flash-002</option>
            <option value="gemini-1.5-flash-001">gemini-1.5-flash-001</option>
            <option value="gemini-1.5-pro-002">gemini-1.5-pro-002</option>
            <option value="gemini-1.5-pro-001">gemini-1.5-pro-001</option>
            <option value="gemini-pro">gemini-pro</option>
          </select>
        </div>
      </div>

      <!-- OpenAI Compatibleè¨­å®šã‚¿ãƒ– -->
      <div id="openai-compatible-tab" class="tab-content">
        <h3 data-i18n="openaiCompatibleSettings">OpenAI Compatible è¨­å®š</h3>
        
        <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠ -->
        <div class="input-group">
          <label for="openaiPreset" data-i18n="preset">ãƒ—ãƒªã‚»ãƒƒãƒˆ</label>
          <select id="openaiPreset">
            <option value="openai">OpenAI</option>
            <option value="chatgpt">ChatGPT</option>
            <option value="azure">Azure OpenAI</option>
            <option value="anthropic">Anthropic Claude</option>
            <option value="groq">Groq</option>
            <option value="deepseek">DeepSeek</option>
            <option value="ollama">Ollama</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        
        <!-- ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ -->
        <div class="input-group">
          <label for="openaiEndpoint" data-i18n="endpoint">ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ</label>
          <input type="url" id="openaiEndpoint" data-i18n-placeholder="placeholderOpenAIEndpoint">
        </div>
        
        <!-- API ã‚­ãƒ¼ -->
        <div class="input-group">
          <label for="openaiApiKey" data-i18n="apiKey">API ã‚­ãƒ¼</label>
          <input type="password" id="openaiApiKey" data-i18n-placeholder="placeholderOpenAIApiKey">
        </div>
        
        <!-- ãƒ¢ãƒ‡ãƒ« -->
        <div class="input-group">
          <label for="openaiModel" data-i18n="model">ãƒ¢ãƒ‡ãƒ«</label>
          <select id="openaiModel">
            <option value="gpt-4o">GPT-4o</option>
            <option value="gpt-4o-mini">GPT-4o mini</option>
            <option value="gpt-4">GPT-4</option>
            <option value="gpt-4-turbo">GPT-4 Turbo</option>
            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
          </select>
        </div>
        
        <!-- Azureç”¨è¿½åŠ è¨­å®š -->
        <div id="azureSettings" class="azure-settings" style="display: none;">
          <div class="input-group">
            <label for="azureApiVersion" data-i18n="apiVersion">API ãƒãƒ¼ã‚¸ãƒ§ãƒ³</label>
            <select id="azureApiVersion">
              <option value="2024-02-15-preview">2024-02-15-preview</option>
              <option value="2023-12-01-preview">2023-12-01-preview</option>
              <option value="2023-05-15">2023-05-15</option>
            </select>
          </div>
          <div class="input-group">
            <label for="azureDeployment" data-i18n="deploymentName">ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆå</label>
            <input type="text" id="azureDeployment" data-i18n-placeholder="placeholderDeploymentName">
          </div>
        </div>
        
        <!-- ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«å…¥åŠ› -->
        <div id="customModelInput" class="input-group" style="display: none;">
          <label for="customModel" data-i18n="customModel">ã‚«ã‚¹ã‚¿ãƒ ãƒ¢ãƒ‡ãƒ«</label>
          <input type="text" id="customModel" data-i18n-placeholder="placeholderCustomModel">
        </div>
        
        <!-- ChatGPTç”¨Organization ID -->
        <div id="organizationInput" class="input-group" style="display: none;">
          <label for="organizationId" data-i18n="organizationId">Organization ID (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)</label>
          <input type="text" id="organizationId" data-i18n-placeholder="placeholderOrganizationId">
        </div>
      </div>


      <!-- AWS Bedrockè¨­å®šã‚¿ãƒ– -->
      <div id="aws-bedrock-tab" class="tab-content">
        <h3 data-i18n="awsBedrockSettings">AWS Bedrock è¨­å®š</h3>
        <div class="input-group">
          <label for="awsAccessKeyId" data-i18n="awsAccessKeyId">AWS Access Key ID</label>
          <input type="password" id="awsAccessKeyId" data-i18n-placeholder="placeholderAWSAccessKeyId">
        </div>
        <div class="input-group">
          <label for="awsSecretAccessKey" data-i18n="awsSecretAccessKey">AWS Secret Access Key</label>
          <input type="password" id="awsSecretAccessKey" data-i18n-placeholder="placeholderAWSSecretAccessKey">
        </div>
        <div class="input-group">
          <label for="awsSessionToken" data-i18n="awsSessionToken">AWS Session Token (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)</label>
          <input type="password" id="awsSessionToken" data-i18n-placeholder="placeholderAWSSessionToken">
        </div>
        <div class="input-group">
          <label for="awsRegion" data-i18n="awsRegion">AWS Region</label>
          <select id="awsRegion">
            <option value="us-east-1">US East (N. Virginia)</option>
            <option value="us-west-2">US West (Oregon)</option>
            <option value="eu-west-1">Europe (Ireland)</option>
            <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
            <option value="ap-northeast-1">Asia Pacific (Tokyo)</option>
          </select>
        </div>
        <div class="input-group">
          <label for="awsBedrockModel" data-i18n="model">ãƒ¢ãƒ‡ãƒ«</label>
          <select id="awsBedrockModel">
            <option value="anthropic.claude-3-5-sonnet-20241022-v2:0">Claude 3.5 Sonnet v2</option>
            <option value="anthropic.claude-3-5-sonnet-20240620-v1:0">Claude 3.5 Sonnet v1</option>
            <option value="anthropic.claude-3-haiku-20240307-v1:0">Claude 3 Haiku</option>
            <option value="anthropic.claude-3-sonnet-20240229-v1:0">Claude 3 Sonnet</option>
            <option value="anthropic.claude-3-opus-20240229-v1:0">Claude 3 Opus</option>
            <option value="amazon.titan-text-premier-v1:0">Titan Text Premier</option>
            <option value="amazon.titan-text-express-v1">Titan Text Express</option>
            <option value="cohere.command-r-plus-v1:0">Command R+</option>
            <option value="cohere.command-r-v1:0">Command R</option>
            <option value="meta.llama3-2-90b-instruct-v1:0">Llama 3.2 90B Instruct</option>
            <option value="meta.llama3-2-11b-instruct-v1:0">Llama 3.2 11B Instruct</option>
            <option value="meta.llama3-2-3b-instruct-v1:0">Llama 3.2 3B Instruct</option>
            <option value="meta.llama3-2-1b-instruct-v1:0">Llama 3.2 1B Instruct</option>
          </select>
        </div>
      </div>

      <!-- å…¨ä½“è¨­å®šã‚¿ãƒ– -->
      <div id="general-tab" class="tab-content">
        <h3 data-i18n="generalSettings">å…¨ä½“è¨­å®š</h3>
        <div class="input-group">
          <label for="defaultProvider" data-i18n="defaultProvider">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ AI ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼</label>
          <select id="defaultProvider">
            <option value="vertex-ai">Vertex AI</option>
            <option value="openai-compatible">OpenAI Compatible</option>
            <option value="aws-bedrock">AWS Bedrock</option>
          </select>
        </div>
        
        <!-- OpenAI Compatible ãƒ—ãƒªã‚»ãƒƒãƒˆé¸æŠ -->
        <div class="input-group" id="openaiCompatiblePresetGroup" style="display: none;">
          <label for="openaiCompatiblePreset" data-i18n="openaiCompatiblePreset">OpenAI Compatible ãƒ—ãƒªã‚»ãƒƒãƒˆ</label>
          <select id="openaiCompatiblePreset">
            <option value="openai">OpenAI</option>
            <option value="chatgpt">ChatGPT</option>
            <option value="azure">Azure OpenAI</option>
            <option value="anthropic">Anthropic Claude</option>
            <option value="groq">Groq</option>
            <option value="deepseek">DeepSeek</option>
            <option value="ollama">Ollama</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        
        <div class="custom-instructions">
          <h4 data-i18n="customInstructions">ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³</h4>
          <div class="input-group">
            <label for="customInstructionsText" data-i18n="customInstructionsText">ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</label>
            <textarea 
              id="customInstructionsText" 
              rows="4" 
              data-i18n-placeholder="placeholderCustomInstructions"
              class="custom-instructions-textarea"
            ></textarea>
            <small class="help-text" data-i18n="customInstructionsHelp">
              ã™ã¹ã¦ã®AI APIã«é©ç”¨ã•ã‚Œã‚‹å…±é€šã®ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã™ã€‚ç©ºæ¬„ã®å ´åˆã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã«ãªã‚Šã¾ã™ã€‚
            </small>
          </div>
        </div>

        <div class="ui-settings">
          <h4 data-i18n="uiSettings">UIè¨­å®š</h4>
          
          <div class="input-group">
            <label for="language" data-i18n="language">è¨€èª</label>
            <select id="language">
              <option value="ja">æ—¥æœ¬èª</option>
              <option value="en">English</option>
            </select>
          </div>
          
          <div class="input-group">
            <label for="fontSize" data-i18n="fontSize">ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º</label>
            <select id="fontSize">
              <option value="8">8pt</option>
              <option value="9">9pt</option>
              <option value="10">10pt</option>
              <option value="11">11pt</option>
              <option value="12" selected>12pt</option>
              <option value="13">13pt</option>
              <option value="14">14pt</option>
              <option value="15">15pt</option>
              <option value="16">16pt</option>
              <option value="17">17pt</option>
              <option value="18">18pt</option>
              <option value="19">19pt</option>
              <option value="20">20pt</option>
              <option value="21">21pt</option>
              <option value="22">22pt</option>
              <option value="23">23pt</option>
              <option value="24">24pt</option>
            </select>
          </div>

          <div class="input-group">
            <label class="checkbox-label">
              <input type="checkbox" id="useShiftEnter" checked>
              <span class="checkmark"></span>
              <span data-i18n="useShiftEnter">Shift+Enterã§é€ä¿¡</span>
            </label>
            <small class="help-text" data-i18n="useShiftEnterHelp">ã‚ªãƒ•ã®å ´åˆã€Enterã‚­ãƒ¼ã§é€ä¿¡ã•ã‚Œã¾ã™</small>
          </div>
        </div>

        <div class="export-settings">
          <h4 data-i18n="exportSettings">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆè¨­å®š</h4>
          
          <div class="input-group">
            <label data-i18n="exportChatHistory">ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</label>
            <div class="export-buttons">
              <button id="exportAllHistory" class="export-button" data-i18n="exportAllHistory">ğŸ“„ å…¨å±¥æ­´ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
              <button id="exportCurrentHistory" class="export-button" data-i18n="exportCurrentHistory">ğŸ“‹ ç¾åœ¨ã®AIå±¥æ­´ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
              <button id="clearLogsButton" class="clear-logs-btn" data-i18n="clearLogs" title="Clear Chat History">ğŸ—‘ï¸ ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢</button>
            </div>
            <small class="help-text" data-i18n="exportHelpText">
              å±¥æ­´ã¯Markdownå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™
            </small>
          </div>
        </div>
      </div>
        
      <div class="button-group">
        <button id="cancelConfig" class="cancel-button" data-i18n="cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button id="saveConfig" class="save-button" data-i18n="saveSettings">è¨­å®šã‚’ä¿å­˜</button>
      </div>
    </div>
  </div>

  <!-- ãƒãƒ£ãƒƒãƒˆç”»é¢ -->
  <div id="chatScreen" class="screen hidden">
    <div class="chat-container">
      <header class="chat-header">
        <h1 id="chatTitle" data-i18n="appTitle">AI Assistant</h1>
        <div class="header-buttons">
          <button id="settingsButton" class="settings-btn"><img src="icons/setting.png" alt="è¨­å®š" class="settings-icon"></button>
        </div>
      </header>
      
      <main class="chat-main">
        <div class="messages" id="messages">
          <div class="welcome-message">
            <p data-i18n="welcomeMessage">Gemini AIã¸ã‚ˆã†ã“ãï¼ä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ</p>
          </div>
        </div>
        
        <div class="input-container">
          <div class="resize-handle" id="resizeHandle">
            <div class="resize-bar"></div>
          </div>
          <div class="input-controls-top">
            <label class="checkbox-control">
              <input type="checkbox" id="includePageContent" />
              <span class="checkmark-custom"></span>
              <span data-i18n="includePageContent">ğŸ“„ ãƒšãƒ¼ã‚¸å†…å®¹ã‚’å«ã‚ã‚‹</span>
            </label>
            <label class="checkbox-control">
              <input type="checkbox" id="includeSelectedText" />
              <span class="checkmark-custom"></span>
              <span data-i18n="includeSelectedText">ğŸ“ é¸æŠãƒ†ã‚­ã‚¹ãƒˆã‚’å«ã‚ã‚‹</span>
            </label>
          </div>
          <div class="input-wrapper">
            <textarea 
              id="messageInput" 
              data-i18n-placeholder="messageInputPlaceholder"
              rows="2"
            ></textarea>
            <button id="sendButton" class="send-button">
              <span id="sendIcon">ğŸ“¤</span>
              <span id="loadingIcon" class="loading hidden">â³</span>
            </button>
          </div>
        </div>
      </main>
    </div>
  </div>
  
  <script src="scripts/marked.min.js"></script>
  <script src="scripts/dompurify.min.js"></script>
  <script src="scripts/i18n.js"></script>
  <script src="scripts/security-manager.js"></script>
  <script src="scripts/crypto-utils.js"></script>
  <script src="scripts/openai-compatible.js"></script>
  <script src="scripts/aws-bedrock.js"></script>
  <script src="scripts/sidepanel.js"></script>
</body>
</html>